# CircleCI config for KERNEL.METAL project
version: 2.1

# Define Ubuntu executor for CI validation
executors:
  ubuntu-executor:
    docker:
      - image: cimg/base:2023.09

# Job to validate code and workflows
jobs:
  validate:
    executor: ubuntu-executor
    steps:
      # Checkout the code
      - checkout
      # Run post-setup script after VM is ready
      - run:
          name: Post-setup
          command: ./post-setup.sh
      # Check if key files exist
      - run:
          name: Check file existence
          command: |
            ls -la kernel.metal main.swift README.md
      # Lint GitHub Actions workflows
      - run:
          name: Run actionlint
          command: |
            curl -s https://raw.githubusercontent.com/rhysd/actionlint/main/scripts/download-actionlint.bash | bash
            ./actionlint .github/workflows/*.yml

# Workflow to run validation
workflows:
  version: 2
  build-and-validate:
    jobs:
      - validate